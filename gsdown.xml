<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs
    title="GSDown - Markdown for Google Site"
    title_url="https://github.com/fabianofranca/gsdown/>"
    author="Fabiano FranÃ§a"
    author_email="email@fabianofranca.com"
    height="0">
    <Require feature="dynamic-height"/>
    <Require feature="setprefs"/>
  </ModulePrefs>
  <UserPref name="text" display_name="Markdown Text"/>
  <Content type="html" view="configuration" preferred_height="160">
  <![CDATA[
    <!--<style type="text/css">
      html, body, #editor {
        margin: 0;
        height: 100%;
        font-family: 'Helvetica Neue', Arial, sans-serif;
      }

      textarea {
        display: inline-block;
        width: 100%;
        height: 100%;
        vertical-align: top;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
        border: none;
        resize: none;
        outline: none;
        font-size: 12px;
        font-family: 'Monaco', courier, monospace;
      }
    </style>
    <div id="editor">
      <textarea v-model="input" debounce="300" placeholder="insert markdown text"></textarea>
    </div>-->
    <div id="editor">
      <textarea v-model="input" debounce="300" id="editor_textarea"></textarea>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/epiceditor/0.2.2/js/epiceditor.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.12/vue.min.js"></script>
    <script type="text/javascript">
      var prefs = new gadgets.Prefs();

      function initConfiguration() {
        var text = decodeURIComponent(prefs.getString("text"));

        var vm = new Vue({
          el: '#editor',
          data: {
            input: text
          }
        });

        vm.$watch('input', function (newVal, oldVal) {
          prefs.set("text", encodeURIComponent(newVal));
        });

        var opts = {
          container: 'editor',
          textarea: 'editor_textarea',
          basePath: 'https://cdnjs.cloudflare.com/ajax/libs/epiceditor/0.2.2/',
          clientSideStorage: false,
          useNativeFullscreen: true,
          parser: marked,
          theme: {
            base: '/themes/base/epiceditor.css',
            preview: '/themes/preview/preview-dark.css',
            editor: '/themes/editor/epic-dark.css'
          },
          button: {
            preview: true,
            fullscreen: false,
            bar: "auto"
          },
          focusOnLoad: true,
          shortcut: {
            modifier: 18,
            fullscreen: 70,
            preview: 80
          },
          string: {
            togglePreview: 'Toggle Preview Mode',
            toggleEdit: 'Toggle Edit Mode',
            toggleFullscreen: 'Enter Fullscreen'
          },
          autogrow: false
        }

        var editor = new EpicEditor(opts).load();

        editor.on('update', function () {
          prefs.set("text", encodeURIComponent($('#editor_textarea').val()));
        });

        gadgets.window.adjustHeight();
      }

      gadgets.util.registerOnLoadHandler(initConfiguration);

    </script>
  ]]>
  </Content>
  <Content type="html" view="home">
  <![CDATA[
    <style type="text/css">
      html, body, #editor {
        margin: 0;
        height: 100%;
        font-family: 'Helvetica Neue', Arial, sans-serif;
      }

      div {
        display: inline-block;
        width: 100%;
        height: 100%;
        vertical-align: top;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
      }
    </style>
    <link rel="stylesheet" href="https://raw.githubusercontent.com/primer/primer/master/css/primer.css">
    <div id="viewer">
      <div v-html="input | marked"></div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.12/vue.min.js"></script>

    <script type="text/javascript">
      var prefs = new gadgets.Prefs();

      function initHome() {
        var text = decodeURIComponent(prefs.getString("text"));

        var vm = new Vue({
          el: '#viewer',
          data: {
            input: text
          },
          filters: {
            marked: marked
          }
        });

        gadgets.window.adjustHeight();
      }

      gadgets.util.registerOnLoadHandler(initHome);
    </script>
  ]]>
  </Content>
</Module>
