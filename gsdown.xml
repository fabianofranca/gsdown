<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs
    title="GSDown - Markdown for Google Site"
    title_url="https://github.com/fabianofranca/gsdown/>"
    author="Fabiano FranÃ§a"
    author_email="email@fabianofranca.com"
    height="0">
    <Require feature="dynamic-height"/>
  </ModulePrefs>
  <UserPref name="text" datatype="hidden" display_name="Markdown Text"/>
  <Content type="html">
  <![CDATA[
    <div id="editor_div">
      <textarea class="form-control" rows="5" id="text_textarea"></textarea>
      <button type="button" class="btn btn-default" id="save_button">Save</button>
    </div>
    <div id="content_div"></div>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://cdn.rawgit.com/showdownjs/showdown/1.3.0/dist/showdown.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

    <script type="text/javascript">
      var prefs = new gadgets.Prefs();

      function init() {
        openEditor();
        refresh();
      }

      function save() {
        prefs.set("text", $("#text_textarea").val());
        refresh();
      }

      function openEditor() {
        var text = $('<div/>').html(prefs.getString("text")).text();
        $("#text_textarea").val(text);
        $("#save_button").click(function() {
          save();
        });
      }

      function refresh() {
        var text = $('<div/>').html(prefs.getString("text")).text();

        var converter = new showdown.Converter();
        var html = converter.makeHtml(text);

        $("#content_div").replaceWith(html);

        gadgets.window.adjustHeight();
      }

      gadgets.util.registerOnLoadHandler(init);
    </script>
  ]]>
  </Content>
</Module>
