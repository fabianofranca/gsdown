<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs
    title="GSDown - Markdown for Google Site"
    title_url="https://github.com/fabianofranca/gsdown/>"
    author="Fabiano FranÃ§a"
    author_email="email@fabianofranca.com"
    height="0">
    <Require feature="dynamic-height"/>
    <Require feature="setprefs"/>
  </ModulePrefs>
  <UserPref name="text" display_name="Markdown Text"/>
  <Content type="html" view="configuration">
  <![CDATA[
    <style type="text/css">
      html, body, #editor {
        margin: 0;
        height: 100%;
        font-family: 'Helvetica Neue', Arial, sans-serif;
        color: #333;
      }

      textarea, #editor div {
        display: inline-block;
        width: 49%;
        height: 100%;
        vertical-align: top;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
        padding: 0 20px;
      }

      textarea {
        border: none;
        border-right: 1px solid #ccc;
        resize: none;
        outline: none;
        background-color: #f6f6f6;
        font-size: 14px;
        font-family: 'Monaco', courier, monospace;
        padding: 20px;
      }

      code {
        color: #f66;
      }
    </style>
    <div id="editor">
      <textarea v-model="input" debounce="300"></textarea>
      <div v-html="input | marked"></div>
    </div>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/vue/1.0.12/vue.min.js"></script>
    <script type="text/javascript">
      var prefs = new gadgets.Prefs();

      function initConfiguration() {
        var text = $('<div/>').html(prefs.getString("text")).text();

        new Vue({
          el: '#editor',
          data: {
            input: text
          },
          filters: {
            marked: marked
          }
        });

        gadgets.window.adjustHeight();
      }

      function save() {
        prefs.set("text", $("#text_textarea").val());
      }

      gadgets.util.registerOnLoadHandler(initConfiguration);

    </script>
  ]]>
  </Content>
  <Content type="html" view="home">
  <![CDATA[
    <div id="content_div"></div>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://cdn.rawgit.com/showdownjs/showdown/1.3.0/dist/showdown.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

    <script type="text/javascript">
      var prefs = new gadgets.Prefs();

      function initHome() {
        refresh();
      }

      function refresh() {
        var text = $('<div/>').html(prefs.getString("text")).text();

        var converter = new showdown.Converter();
        var html = converter.makeHtml(text);

        console.log(html);4
        $("#content_div").replaceWith(html);

        gadgets.window.adjustHeight();
      }

      gadgets.util.registerOnLoadHandler(initHome);
    </script>
  ]]>
  </Content>
</Module>
